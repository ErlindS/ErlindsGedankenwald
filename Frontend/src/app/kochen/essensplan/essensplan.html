<div class="meal-plan-container">
    <header class="meal-plan-header">
        <h1>üóìÔ∏è Mein Essensplan</h1>
        <p class="subtitle">W√§hle eine Themenwoche und entdecke die Gerichte der Tage</p>
    </header>

    <!-- Week Selection Tabs -->
    <div class="week-tabs">
        <button *ngFor="let week of weeks" class="week-btn" [class.active]="activeWeekId === week.id"
            (click)="setWeek(week.id)">
            <span class="week-emoji">{{week.emoji}}</span>
            <span class="week-name">{{week.title}} <span class="week-theme">{{week.theme}}</span></span>
        </button>
    </div>

    <!-- Divider between Weeks and Days -->
    <div class="tab-divider">
        <hr>
    </div>

    <!-- Day Selection Tabs -->
    <div class="day-tabs">
        <button *ngFor="let day of activeWeek.days" class="day-btn" [class.active]="activeDayId === day.id"
            (click)="setDay(day.id)">
            <span class="day-emoji">{{day.emoji}}</span>
            <span class="day-name">{{day.name}}</span>
        </button>
    </div>

    <!-- Active Recipe / Day Content -->
    <div class="active-recipe-card">
        <div class="recipe-header">
            <div class="recipe-title-group">
                <span class="recipe-emoji">{{ activeDayData.emoji }}</span>
                <div>
                    <h2 class="recipe-title">{{ activeDayData.title }}</h2>
                    <span class="recipe-type">{{ activeDayData.name }} | {{ activeDayData.type }}</span>
                </div>
            </div>
        </div>

        <div class="recipe-body" [class.is-restday]="activeDayData.isRestday">
            <div class="recipe-section" *ngFor="let section of activeDayData.sections">
                <h4>{{ section.title }}</h4>
                <ul class="recipe-items">
                    <li *ngFor="let item of section.items">{{ item }}</li>
                </ul>
            </div>

            <p class="variation-text" *ngIf="activeDayData.variation">
                {{ activeDayData.variation }}
            </p>
        </div>

        <!-- Recipe History Section -->
        <div class="history-container">
            <div class="history-title-wrapper">
                <h4 class="history-title">üï∞Ô∏è Letzte Male gekocht</h4>
                <button class="add-history-btn" (click)="openAddModal()">‚ûï Neuer Eintrag</button>
            </div>

            <div class="history-empty" *ngIf="!activeDayData.history || activeDayData.history.length === 0">
                <p>Noch keine Eintr√§ge f√ºr dieses Rezept vorhanden.</p>
            </div>

            <div class="history-list" *ngIf="activeDayData.history && activeDayData.history.length > 0">
                <div class="history-item" *ngFor="let record of activeDayData.history"
                    [class.expanded]="expandedHistoryItems[record.id]">
                    <div class="history-header" (click)="toggleHistory(record.id)">
                        <div class="history-meta">
                            <span class="history-date">{{ record.date }}</span>
                            <span class="history-name">{{ record.specificName }}</span>
                        </div>
                        <div class="history-actions">
                            <span class="history-rating">{{ generateStars(record.rating) }}</span>
                            <span class="history-toggle-icon">‚ñæ</span>
                        </div>
                    </div>
                    <div class="history-content">
                        <div class="history-content-inner">
                            <p class="history-comment">"{{ record.comment }}"</p>
                            <a *ngIf="record.recipeLink" [href]="record.recipeLink" target="_blank"
                                class="history-link">Rezept Link üîó</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- General Extras Section -->
    <div class="general-extras-container" *ngIf="activeWeekId === 1">
        <!-- Just showing global extras once or at bottom -->
        <h3 class="general-extras-title">üí° Allgemeine Ideen & Extras</h3>
        <p class="general-hint">Grunds√§tzlich: Morgens immer Fr√ºchte üçé / Abends Gem√ºse ü•¶</p>

        <div class="extras-grid">
            <div class="general-extra-card">
                <div class="extra-icon">üåÖ</div>
                <div class="extra-content">
                    <h4>Morgens</h4>
                    <p>French Toast, Haferflocken (Oats/Porridge), Baked Beans, Smoothie-Bowls.</p>
                </div>
            </div>
            <div class="general-extra-card">
                <div class="extra-icon">üçü</div>
                <div class="extra-content">
                    <h4>Beilagen</h4>
                    <p>Pfannkuchen, Milchshakes, Cole Slaw, S√º√ükartoffel-Pommes, Weinbl√§tter, Mochi.</p>
                </div>
            </div>
            <div class="general-extra-card">
                <div class="extra-icon">üåô</div>
                <div class="extra-content">
                    <h4>Abends-Extra</h4>
                    <p>Hummus-Dip, Gef√ºllte Weinbl√§tter, Bruschetta, Zapiekanka.</p>
                </div>
            </div>
        </div>
        <!-- Add Entry Modal -->
        <div class="modal-overlay" *ngIf="showAddModal" (click)="closeAddModal()">
            <div class="modal-content" (click)="$event.stopPropagation()">
                <div class="modal-header">
                    <h3>Neuen Eintrag f√ºr {{ activeDayData.name }}</h3>
                    <button class="close-btn" (click)="closeAddModal()">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Datum</label>
                        <input type="text" [(ngModel)]="newEntry.date" placeholder="z.B. 22.02.2026">
                    </div>
                    <div class="form-group">
                        <label>Spezifisches Rezept</label>
                        <input type="text" [(ngModel)]="newEntry.specificName" placeholder="z.B. Spaghetti Carbonara">
                    </div>
                    <div class="form-group">
                        <label>Bewertung (Sterne)</label>
                        <input type="number" min="1" max="5" [(ngModel)]="newEntry.rating">
                    </div>
                    <div class="form-group">
                        <label>Kommentar</label>
                        <textarea [(ngModel)]="newEntry.comment" rows="3" placeholder="Wie war's?"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Rezept Link (optional)</label>
                        <input type="text" [(ngModel)]="newEntry.recipeLink" placeholder="https://...">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="cancel-btn" (click)="closeAddModal()">Abbrechen</button>
                    <button class="save-btn" (click)="saveNewEntry()">Speichern</button>
                </div>
            </div>
        </div>
    </div>